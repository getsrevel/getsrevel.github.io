<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.142.0"><meta name=generator content="Relearn 7.3.2+db9ca5d2958a7e5956d4f37f6d79e8d2076b8381"><meta name=description content="Dette er eksempel viser hvordan man kan streame indholdet af et html canvas element (en p5js sketch) til en anden maskine. Streaming delen h친ndteres af WebRTC, og etablering af forbindelsen h친ndteres ved hj칝lp af Socket.io.
Ops칝tning af projekt F칮rst skal der laves et projekt s친 node kan finde ud af at k칮re programmet, og har en package.json fil til at holde styr p친 projektet og afh칝ngigheder af biblioteksmoduler.
Start med at lave en mappe, som kan indeholde dit projekt. Kald den f.eks. webrtc-server. I denne mappe skal du k칮re f칮lgende kommando, for at oprette projekt filen package.json."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Webrtc Server :: Getsrevel"><meta name=twitter:description content="Dette er eksempel viser hvordan man kan streame indholdet af et html canvas element (en p5js sketch) til en anden maskine. Streaming delen h친ndteres af WebRTC, og etablering af forbindelsen h친ndteres ved hj칝lp af Socket.io.
Ops칝tning af projekt F칮rst skal der laves et projekt s친 node kan finde ud af at k칮re programmet, og har en package.json fil til at holde styr p친 projektet og afh칝ngigheder af biblioteksmoduler.
Start med at lave en mappe, som kan indeholde dit projekt. Kald den f.eks. webrtc-server. I denne mappe skal du k칮re f칮lgende kommando, for at oprette projekt filen package.json."><meta property="og:url" content="https://getsrevel.github.io/tech/node/webrtc-server/index.html"><meta property="og:site_name" content="Getsrevel"><meta property="og:title" content="Webrtc Server :: Getsrevel"><meta property="og:description" content="Dette er eksempel viser hvordan man kan streame indholdet af et html canvas element (en p5js sketch) til en anden maskine. Streaming delen h친ndteres af WebRTC, og etablering af forbindelsen h친ndteres ved hj칝lp af Socket.io.
Ops칝tning af projekt F칮rst skal der laves et projekt s친 node kan finde ud af at k칮re programmet, og har en package.json fil til at holde styr p친 projektet og afh칝ngigheder af biblioteksmoduler.
Start med at lave en mappe, som kan indeholde dit projekt. Kald den f.eks. webrtc-server. I denne mappe skal du k칮re f칮lgende kommando, for at oprette projekt filen package.json."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Webrtc Server :: Getsrevel"><meta itemprop=description content="Dette er eksempel viser hvordan man kan streame indholdet af et html canvas element (en p5js sketch) til en anden maskine. Streaming delen h친ndteres af WebRTC, og etablering af forbindelsen h친ndteres ved hj칝lp af Socket.io.
Ops칝tning af projekt F칮rst skal der laves et projekt s친 node kan finde ud af at k칮re programmet, og har en package.json fil til at holde styr p친 projektet og afh칝ngigheder af biblioteksmoduler.
Start med at lave en mappe, som kan indeholde dit projekt. Kald den f.eks. webrtc-server. I denne mappe skal du k칮re f칮lgende kommando, for at oprette projekt filen package.json."><meta itemprop=datePublished content="2021-01-20T11:01:36+01:00"><meta itemprop=dateModified content="2021-01-20T11:01:36+01:00"><meta itemprop=wordCount content="1057"><title>Webrtc Server :: Getsrevel</title>
<link href=/tech/node/webrtc-server/index.xml rel=alternate type=application/rss+xml title="Webrtc Server :: Getsrevel"><link href=/css/fontawesome-all.min.css?1738479531 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css?1738479531 rel=stylesheet></noscript><link href=/css/auto-complete.css?1738479531 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/auto-complete.css?1738479531 rel=stylesheet></noscript><link href=/css/perfect-scrollbar.min.css?1738479531 rel=stylesheet><link href=/css/theme.min.css?1738479531 rel=stylesheet><link href=/css/format-html.min.css?1738479531 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://getsrevel.github.io",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["getsrevel","getsrevel-neon","zen-auto","zen-light","zen-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-7562NSC4SP"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7562NSC4SP")</script></head><body class="mobile-support html" data-url=/tech/node/webrtc-server/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#ops칝tning-af-projekt>Ops칝tning af projekt</a></li><li><a href=#server>Server</a></li><li><a href=#afsender-af-video-stream>Afsender af video stream</a><ul><li><a href=#tegn-p친-canvas>Tegn p친 canvas</a></li><li><a href=#styring-af-video-stream>Styring af video stream</a></li><li><a href=#visning-i-browser>Visning i browser</a></li></ul></li><li><a href=#modtager-af-video-stream>Modtager af video stream</a></li><li><a href=#afpr칮vning>Afpr칮vning</a><ul><li><a href=#materiale>Materiale</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Getsrevel</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/tech/index.html><span itemprop=name>Tech</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/tech/node/index.html><span itemprop=name>Node.js</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Webrtc Server</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/tech/node/web-server/index.html title="Web Server (游몛)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/tech/node/readline-stdin/index.html title="Readline on Stdin (游)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable tech" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=webrtc-server>Webrtc Server</h1><p>Dette er eksempel viser hvordan man kan streame indholdet af et html canvas element (en <a href=https://p5js.org/ rel=external target=_blank>p5js sketch</a>) til en anden maskine.
Streaming delen h친ndteres af <a href=https://webrtc.org/ rel=external target=_blank>WebRTC</a>, og etablering af forbindelsen h친ndteres ved hj칝lp af <a href=http://socket.io/ rel=external target=_blank>Socket.io</a>.</p><h2 id=ops칝tning-af-projekt>Ops칝tning af projekt</h2><p>F칮rst skal der laves et projekt s친 node kan finde ud af at k칮re programmet, og har en <code>package.json</code> fil til at holde styr p친 projektet og afh칝ngigheder af biblioteksmoduler.</p><p>Start med at lave en mappe, som kan indeholde dit projekt. Kald den f.eks. <code>webrtc-server</code>.
I denne mappe skal du k칮re f칮lgende kommando, for at oprette projekt filen <code>package.json</code>.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>npm init</span></span></code></pre></div><p>Udfyld passende v칝rdier som svar p친 de sp칮rgsm친l programmet stiller.
Jeg foresl친r at 칝ndre din main fil til <code>server.js</code>.</p><p>Dern칝st har du mulighed for at installere disse afh칝ngigheder.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>npm install express
</span></span><span style=display:flex><span>npm install socket.io</span></span></code></pre></div><p>Inds칝t en start action i script sektionen.</p><p>Du burde nu have en <code>package.json</code> fil, der ser nogenlunde s친dan ud:</p><div class="highlight wrap-code" hl_lines=13-14><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;webrtccanvasbroadcast&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Example of streaming canvas content using WebRTC&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;main&#34;</span>: <span style=color:#e6db74>&#34;server.js&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;start&#34;</span>: <span style=color:#e6db74>&#34;node server.js&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;test&#34;</span>: <span style=color:#e6db74>&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;author&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;license&#34;</span>: <span style=color:#e6db74>&#34;ISC&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;dependencies&#34;</span>: {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#f92672>&#34;express&#34;</span>: <span style=color:#e6db74>&#34;^4.17.1&#34;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#f92672>&#34;socket.io&#34;</span>: <span style=color:#e6db74>&#34;^3.1.0&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Bem칝rk de to pakker der er listet under afh칝ngigheder.</p><h2 id=server>Server</h2><p>De statiske web-resourcer placeres i mappen public, og de g칮res tilg칝ngelige p친 samme m친de som i eksemplet med den <a href=/tech/node/web-server/index.html>simple web server</a>.</p><p>Derudover best친r serveren af en r칝kke endpoints, der h친ndterer socket.io beskeder.
Dette er n칮dvendigt for at kunne styre transmission af videostr칮mmen, da dette ikke er indbygget i <a href=https://webrtc.org/ rel=external target=_blank>WebRTC</a>.</p><p>Koden til serveren placeres i filen <code>server.js</code>.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;express&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>broadcaster</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>port</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;http&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>createServer</span>(<span style=color:#a6e22e>app</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>io</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;socket.io&#34;</span>)(<span style=color:#a6e22e>server</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#66d9ef>static</span>(<span style=color:#a6e22e>__dirname</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/public&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>e</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>e</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;connection&#34;</span>, <span style=color:#a6e22e>socket</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;broadcaster&#34;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>broadcaster</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Broadcaster id: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>broadcaster</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>broadcast</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;broadcaster&#34;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;watcher&#34;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Watcher id: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>to</span>(<span style=color:#a6e22e>broadcaster</span>).<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;watcher&#34;</span>, <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;offer&#34;</span>, (<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>message</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Offer id: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, message: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>to</span>(<span style=color:#a6e22e>id</span>).<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;offer&#34;</span>, <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;answer&#34;</span>, (<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>message</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Answer id: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, message: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>to</span>(<span style=color:#a6e22e>id</span>).<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;answer&#34;</span>, <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;candidate&#34;</span>, (<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>message</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Candidate id: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, message: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>to</span>(<span style=color:#a6e22e>id</span>).<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;candidate&#34;</span>, <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;disconnect&#34;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Disconnect id: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>to</span>(<span style=color:#a6e22e>broadcaster</span>).<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;disconnectPeer&#34;</span>, <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#a6e22e>port</span>, () =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Server is running on port </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>port</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>));</span></span></code></pre></div><p>N친r du 칮nsker at starte serveren, kan det g칮res med kommandoen.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>npm start</span></span></code></pre></div><h2 id=afsender-af-video-stream>Afsender af video stream</h2><p>For at have noget at sende afsted laves en sketch ved hj칝lp af <a href=/tech/p5js/intro/index.html>p5js</a>, der streames til modtagerne med <a href=https://webrtc.org/ rel=external target=_blank>WebRTC</a>.</p><h3 id=tegn-p친-canvas>Tegn p친 canvas</h3><p>Der laves en sketch, der tegner noget p친 det canvas element, som skal transmitteres.
I eksemplet tegnes blot en r칮d cirkel med sort omrids p친 musens position.
Dette laves i filen <code>public/broadcast/sketch.js</code>.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>stream</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Capture the canvas content as a stream
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>htmlCanvas</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>elt</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stream</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlCanvas</span>.<span style=color:#a6e22e>captureStream</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gotStream</span>(<span style=color:#a6e22e>stream</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>220</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Draw a red circle at the position of the mouse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#39;red&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>circle</span>(<span style=color:#a6e22e>mouseX</span>, <span style=color:#a6e22e>mouseY</span>, <span style=color:#ae81ff>50</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=styring-af-video-stream>Styring af video stream</h3><p>For at kunne h친ndtere WebRTC forbindelsen kommunikeres med serveren via <a href=http://socket.io/ rel=external target=_blank>Socket.io</a>.</p><p>Klient-delen der styrer afsendelsen laves i <code>public/broadcast/webrtc.js</code></p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>peerConnections</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>iceServers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;urls&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;stun:stun.l.google.com:19302&#34;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>socket</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>connect</span>(window.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>origin</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;answer&#34;</span>, (<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>description</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnections</span>[<span style=color:#a6e22e>id</span>].<span style=color:#a6e22e>setRemoteDescription</span>(<span style=color:#a6e22e>description</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;watcher&#34;</span>, <span style=color:#a6e22e>id</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>peerConnection</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RTCPeerConnection</span>(<span style=color:#a6e22e>config</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnections</span>[<span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>peerConnection</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>stream</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>stream</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stream</span>.<span style=color:#a6e22e>getTracks</span>().<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>track</span> =&gt; <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>addTrack</span>(<span style=color:#a6e22e>track</span>, <span style=color:#a6e22e>stream</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>onicecandidate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>candidate</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;candidate&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>candidate</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>createOffer</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>sdp</span> =&gt; <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>setLocalDescription</span>(<span style=color:#a6e22e>sdp</span>))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;offer&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>localDescription</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;candidate&#34;</span>, (<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>candidate</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnections</span>[<span style=color:#a6e22e>id</span>].<span style=color:#a6e22e>addIceCandidate</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RTCIceCandidate</span>(<span style=color:#a6e22e>candidate</span>));
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;disconnectPeer&#34;</span>, <span style=color:#a6e22e>id</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnections</span>[<span style=color:#a6e22e>id</span>].<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>delete</span> <span style=color:#a6e22e>peerConnections</span>[<span style=color:#a6e22e>id</span>];
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>window.<span style=color:#a6e22e>onunload</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>onbeforeunload</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>gotStream</span>(<span style=color:#a6e22e>stream</span>) {
</span></span><span style=display:flex><span>  window.<span style=color:#a6e22e>stream</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>stream</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;broadcaster&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleError</span>(<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Error: &#34;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=visning-i-browser>Visning i browser</h3><p>Javascript koden kan ikke st친 alene.
For at kunne eksekvere den i browseren bliver den indsat p친 en simpel web side i filen <code>public/broadcast/index.html</code>.</p><div class="highlight wrap-code" hl_lines="7-9 13 15-16"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Video stream - Broadcaster&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/p5lib/p5.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/p5lib/p5.sound.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/css&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;../styles.css&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h1</span>&gt;Video stream - Broadcaster&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sketch.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/socket.io/socket.io.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;webrtc.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;</span></span></code></pre></div><p>Bem칝rk at filen <a href=https://socket.io/docs/v3/client-installation/#Installation rel=external target=_blank>/socket.io/socket.io.js</a> genereres automatisk af serveren n친r socket.io pakken benyttes.</p><p>For at kunne tegne p친 canvas med <a href=/tech/node/webrtc-server/index.html>p5js</a> i <code>public/broadcast/sketch.js</code> er det n칮dvendigt at inkludere p5 biblioteksfilerne.
Disse er placeret i <code>public/p5lib</code>.</p><ul><li><a href=demo/public/p5lib/p5.min.js>public/p5lib/p5.min.js</a></li><li><a href=demo/public/p5lib/p5.sound.min.js>public/p5lib/p5.sound.min.js</a></li></ul><p>Der benyttes ogs친 en smule css som placeres i <code>public/styles.css</code>.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>html</span><span style=color:#f92672>,</span> <span style=color:#f92672>body</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>margin</span>: <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>padding</span>: <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>canvas</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>block</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>video</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>400</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>height</span>: <span style=color:#ae81ff>400</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-color</span>: <span style=color:#66d9ef>black</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=modtager-af-video-stream>Modtager af video stream</h2><p>Den modtagende ende af videostr칮mmen laves ogs친 som en simpel webside.
Det er den man skal se, n친r man bes칮ger serveren.</p><p>Lav filen <code>public/index.html</code> med dette indhold.</p><div class="highlight wrap-code" hl_lines=13><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Video stream - Viewer&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/styles.css&#34;</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h1</span>&gt;Video stream - Viewer&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>video</span> <span style=color:#a6e22e>playsinline</span> <span style=color:#a6e22e>autoplay</span> <span style=color:#a6e22e>muted</span>&gt;&lt;/<span style=color:#f92672>video</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/socket.io/socket.io.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/watch.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;</span></span></code></pre></div><p>Til at styre modtagelsen af WebRTC str칮mmen benyttes scriptet <code>public/watch.js</code> med dette indhold.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>peerConnection</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>iceServers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      { 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;urls&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;stun:stun.l.google.com:19302&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#75715e>// { 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>//   &#34;urls&#34;: &#34;turn:TURN_IP?transport=tcp&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>//   &#34;username&#34;: &#34;TURN_USERNAME&#34;,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>//   &#34;credential&#34;: &#34;TURN_CREDENTIALS&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  ]
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>socket</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>connect</span>(window.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>origin</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>video</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#34;video&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;offer&#34;</span>, (<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>description</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RTCPeerConnection</span>(<span style=color:#a6e22e>config</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setRemoteDescription</span>(<span style=color:#a6e22e>description</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>createAnswer</span>())
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>sdp</span> =&gt; <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>setLocalDescription</span>(<span style=color:#a6e22e>sdp</span>))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;answer&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>localDescription</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>ontrack</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>video</span>.<span style=color:#a6e22e>srcObject</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>streams</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>onicecandidate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>candidate</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;candidate&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>candidate</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;candidate&#34;</span>, (<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>candidate</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>addIceCandidate</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RTCIceCandidate</span>(<span style=color:#a6e22e>candidate</span>))
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>e</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>e</span>));
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;connect&#34;</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;watcher&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;broadcaster&#34;</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#34;watcher&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>window.<span style=color:#a6e22e>onunload</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>onbeforeunload</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>peerConnection</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>};</span></span></code></pre></div><h2 id=afpr칮vning>Afpr칮vning</h2><p>Nu burde du kunne start serveren med kommandoen.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>npm start</span></span></code></pre></div><p>For at starte transmissionen skal 친bne <a href=http://localhost:4000/broadcast rel=external target=_blank>http://localhost:4000/broadcast</a>.</p><p>Hvis du derefter bes칮ger <a href=http://localhost:4000 rel=external target=_blank>http://localhost:4000</a> i et andet browservindue, kan du se en video transmission af din sketch.</p><figure><img src=/tech/node/webrtc-server/screenshot-webrtc-rx-tx.png alt="Screenshot af to browserviduer."><figcaption><h4>Screenshot af de to browserviduer med sender og modtager.</h4></figcaption></figure><p>Bem칝rk at videoen stopper, hvis du lukker det f칮rste browservindue. Den burde starte igen, n칝ste gang du bes칮ger <a href=http://localhost:4000/broadcast rel=external target=_blank>http://localhost:4000/broadcast</a>.</p><h3 id=materiale>Materiale</h3><ul><li><a href=https://nodejs.org/en/ rel=external target=_blank>Node</a></li><li><a href=https://www.npmjs.com/ rel=external target=_blank>npm - Node Package Manager</a></li><li><a href=http://socket.io/ rel=external target=_blank>Socket.io</a></li><li><a href=https://socket.io/docs/v3/ rel=external target=_blank>Socket.io Version3 Documentation</a></li><li><a href=https://socket.io/get-started/chat/ rel=external target=_blank>Socket.io - Get started</a></li><li><a href=http://expressjs.com/ rel=external target=_blank>Express</a></li><li><a href=https://www.npmjs.com/package/express rel=external target=_blank>express - nmp package</a></li><li><a href=https://webrtc.org/ rel=external target=_blank>WebRTC</a></li><li><a href=https://p5js.org/ rel=external target=_blank>p5.js</a></li><li><a href=https://p5js.org/get-started/ rel=external target=_blank>p5js getting started</a></li><li><a href=https://p5js.org/reference/ rel=external target=_blank>p5js reference</a></li></ul><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=R-logo class=R-default href=/index.html style="font-family:supermercado one;font-size:3.5em">{GR}</a></div><script>window.index_js_url="/searchindex.en.js?1738479531"</script><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search><script>var contentLangs=["en"]</script><script src=/js/auto-complete.js?1738479531 defer></script><script src=/js/lunr/lunr.min.js?1738479531 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1738479531 defer></script><script src=/js/lunr/lunr.multi.min.js?1738479531 defer></script><script src=/js/lunr/lunr.en.min.js?1738479531 defer></script><script src=/js/search.js?1738479531 defer></script></div><div id=R-homelinks class=default-animation><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-shortcutmenu-home class=R-sidebarmenu><ul class="enlarge morespace collapsible-menu"><li class=parent data-nav-id=/tech/index.html><a class=padding href=/tech/index.html>Tech</a><ul id=R-subsections-ceedbbae74c0ccc18084cc8e5a7d9667 class=collapsible-menu><li data-nav-id=/tech/html/index.html><a class=padding href=/tech/html/index.html>Html</a></li><li class=alwaysopen data-nav-id=/tech/css/index.html><a class=padding href=/tech/css/index.html>Css</a><ul id=R-subsections-0343259045b469242322e514f66f3e1e class=collapsible-menu></ul></li><li class=alwaysopen data-nav-id=/tech/arduino/index.html><a class=padding href=/tech/arduino/index.html>Arduino</a><ul id=R-subsections-63d486dbcaa700e3a2a9b957c1e3cb10 class=collapsible-menu></ul></li><li class=alwaysopen data-nav-id=/tech/c-sharp/index.html><a class=padding href=/tech/c-sharp/index.html>C#</a><ul id=R-subsections-d078332f5e4619bf9906701fc2c941b4 class=collapsible-menu></ul></li><li class=alwaysopen data-nav-id=/tech/react/index.html><a class=padding href=/tech/react/index.html>React</a><ul id=R-subsections-6bcda600e534de832102f164006e0f1b class=collapsible-menu></ul></li><li data-nav-id=/tech/chartjs/index.html><a class=padding href=/tech/chartjs/index.html>Chart.js</a></li><li class=alwaysopen data-nav-id=/tech/firebase/index.html><a class=padding href=/tech/firebase/index.html>Firebase</a><ul id=R-subsections-5ff30eb9a086353af3d3d2647d3231b4 class=collapsible-menu></ul></li><li data-nav-id=/tech/regex/index.html><a class=padding href=/tech/regex/index.html>Regex</a></li><li class=alwaysopen data-nav-id=/tech/mindstorms/index.html><a class=padding href=/tech/mindstorms/index.html>Mindstorms</a><ul id=R-subsections-1f164dfe3dbda7ecfb56a0b47be19cc3 class=collapsible-menu></ul></li><li data-nav-id=/tech/hugo/index.html><a class=padding href=/tech/hugo/index.html>Hugo</a></li><li class="parent alwaysopen" data-nav-id=/tech/node/index.html><a class=padding href=/tech/node/index.html>Node.js</a><ul id=R-subsections-4ee672adfd2a2aa9e6c92ed2af566be7 class=collapsible-menu><li data-nav-id=/tech/node/intro/index.html><a class=padding href=/tech/node/intro/index.html>Intro</a></li><li data-nav-id=/tech/node/cli-args/index.html><a class=padding href=/tech/node/cli-args/index.html>CLI arguments</a></li><li data-nav-id=/tech/node/discord-bot/index.html><a class=padding href=/tech/node/discord-bot/index.html>Discord Bot</a></li><li data-nav-id=/tech/node/web-server/index.html><a class=padding href=/tech/node/web-server/index.html>Web Server</a></li><li class=active data-nav-id=/tech/node/webrtc-server/index.html><a class=padding href=/tech/node/webrtc-server/index.html>Webrtc Server</a></li><li data-nav-id=/tech/node/readline-stdin/index.html><a class=padding href=/tech/node/readline-stdin/index.html>Readline on Stdin</a></li><li data-nav-id=/tech/node/serial-json/index.html><a class=padding href=/tech/node/serial-json/index.html>Serial Json</a></li><li data-nav-id=/tech/node/socket-io-demo/index.html><a class=padding href=/tech/node/socket-io-demo/index.html>Socket IO</a></li><li data-nav-id=/tech/node/web-scraping/index.html><a class=padding href=/tech/node/web-scraping/index.html>Web Scraping</a></li></ul></li><li class=alwaysopen data-nav-id=/tech/p5js/index.html><a class=padding href=/tech/p5js/index.html>p5.js</a><ul id=R-subsections-79dff7595307b1989d067d71388fad8a class=collapsible-menu></ul></li></ul></li><li data-nav-id=/project/index.html><a class=padding href=/project/index.html>Project</a><ul id=R-subsections-2ca1f4ebdc59348ffdc31d97a51a98d5 class=collapsible-menu></ul></li><li data-nav-id=/tools/index.html><a class=padding href=/tools/index.html>Tools</a><ul id=R-subsections-bf1399820dde3dd110e03ace4147ff86 class=collapsible-menu></ul></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVariantSwitch"><ul><li id=R-select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fa-fw fas fa-language"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Language</label>
<select id=R-select-language onchange="location=this.querySelector(this.value).dataset.url"><option id=R-select-language-en value=#R-select-language-en data-url=/tech/node/webrtc-server/index.html lang=en-us selected></option></select></div><div class=clear></div></div></li><li id=R-select-variant-container class="footerVariantSwitch showVariantSwitch"><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Theme</label>
<select id=R-select-variant onchange=window.relearn.changeVariant(this.value)><option id=R-select-variant-getsrevel value=getsrevel selected>Getsrevel</option><option id=R-select-variant-getsrevel-neon value=getsrevel-neon>Getsrevel Neon</option><option id=R-select-variant-zen-auto value=zen-auto>Zen Light/Dark</option><option id=R-select-variant-zen-light value=zen-light>Zen Light</option><option id=R-select-variant-zen-dark value=zen-dark>Zen Dark</option></select></div><div class=clear></div></div><script>window.relearn.markVariant()</script></li><li class=footerVisitedLinks><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><p>&copy; 2019 - 2025</p><canvas id=qr></canvas>
<script src=https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js integrity="sha256-25ncr0CpJhgbzkUiR3wu/Fkk9sSykRG2qX+upHfJUos=" crossorigin=anonymous></script><script>(function(){let e=new QRious({element:document.getElementById("qr"),size:200,level:"H",background:"#b3b3b3",value:window.location.href})})()</script></div></div></div></aside><script src=/js/clipboard.min.js?1738479531 defer></script><script src=/js/perfect-scrollbar.min.js?1738479531 defer></script><script src=/js/theme.js?1738479531 defer></script></body></html>